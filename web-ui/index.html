<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebXR Camera Viewer</title>
    
    <!-- A-Frame and dependencies -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- Remove A-Frame's built-in grabbable component to avoid conflict with super-hands -->
    <script>delete AFRAME.components["grabbable"];</script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.misc.min.js"></script>
    <script src="https://unpkg.com/super-hands@3.0.5/dist/super-hands.min.js"></script>
    
    <!-- Application modules -->
    <script src="js/websocket-manager.js"></script>
    <script src="js/webrtc-manager.js"></script>
    <script src="js/components/laser-visibility.js"></script>
    <script src="js/components/look-at-headset.js"></script>
    <script src="js/components/video-panel.js"></script>
    <script src="js/components/controller-axes.js"></script>
    <script src="js/components/vr-button.js"></script>
    <script src="js/components/websocket-panel.js"></script>
    <script src="js/components/passthrough-manager.js"></script>
  </head>
  <body>
    <a-scene 
      passthrough-manager
      xr-mode-ui="XRMode: ar"
      background="transparent: true">
      <a-assets></a-assets>
      
      <!-- Environment -->
      <a-sky color="#222"></a-sky>
      <a-plane rotation="-90 0 0" width="20" height="20" color="#444"></a-plane>

      <!-- Container for dynamically created panels -->
      <a-entity id="panel-container" video-panel></a-entity>

      <!-- WebSocket connection panel -->
      <a-entity id="websocket-panel" websocket-panel></a-entity>

      <!-- Left hand controller with laser ray -->
      <a-entity 
        id="left-hand"
        super-hands="colliderEvent: raycaster-intersection; colliderEventProperty: els; colliderEndEvent: raycaster-intersection-cleared; colliderEndEventProperty: clearedEls"
        meta-touch-controls="hand: left; controllerType: quest3"
        laser-controls="hand: left"
        raycaster="objects: .draggable, .clickable; far: 5; lineColor: #ff6b6b; lineOpacity: 0.8"
        line="color: #ff6b6b; opacity: 0; visible: false"
        laser-visibility
        controller-axes="showPosition: true">
      </a-entity>

      <!-- Right hand controller with laser ray -->
      <a-entity 
        id="right-hand"
        super-hands="colliderEvent: raycaster-intersection; colliderEventProperty: els; colliderEndEvent: raycaster-intersection-cleared; colliderEndEventProperty: clearedEls"
        meta-touch-controls="hand: right; controllerType: quest3"
        laser-controls="hand: right"
        raycaster="objects: .draggable, .clickable; far: 5; lineColor: #6bcf7f; lineOpacity: 0.8"
        line="color: #6bcf7f; opacity: 0; visible: false"
        laser-visibility
        controller-axes="showPosition: true">
      </a-entity>
    </a-scene>
  </body>
</html>
